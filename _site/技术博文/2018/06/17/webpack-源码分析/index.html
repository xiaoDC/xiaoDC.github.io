<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      webpack æºç åˆ†æ &middot; fri3nds
    
  </title>

  <!-- CSS -->
  <!-- <link rel="stylesheet" href="/public/css/syntax.css"> -->
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/pygments.css">
  <link rel="stylesheet" href="/public/css/font-awesome.min.css">
  <!-- <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400"> -->

  <!-- Icons -->
  <!-- <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/img/apple-touch-icon-144-precomposed.png"> -->
  <link rel="shortcut icon" href="/public/img/chenglong.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- livereload test -->
  <!--<script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>-->

  <!-- audioplayer -->
  <script src="/public/js/jquery-1.11.1.js"></script>
  <script src="/public/js/audioplayer/amazingaudioplayer.js"></script>
  <link rel="stylesheet" type="text/css" href="/public/css/audioplayer/initaudioplayer-1.css">
  <script src="/public/js/audioplayer/initaudioplayer-1.js"></script>
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?32fe7477dc34484123ca3fe5001749c6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
</head>


  <body class="">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <div class="sidebar-logo">
      <a href="/"><img src="/public/img/chenglong.jpg"></a>
    </div>
    <p>Here is my personal weblog about technology and life.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/"><i class="fa fa-home fa-fw"></i>&nbsp ä¸»é¡µÂ·&nbspHome</a>
    <a class="sidebar-nav-item" href="/archive/"><i class="fa fa-file-text-o fa-fw"></i>&nbsp å½’æ¡£Â·&nbspArchive</a>
    <a class="sidebar-nav-item" href="/category/"><i class="fa fa-book fa-fw"></i>&nbsp åˆ†ç±»Â·&nbspCategory</a>
    <a class="sidebar-nav-item" href="/tag/"><i class="fa fa-tags fa-fw"></i>&nbsp æ ‡ç­¾Â·&nbspTag</a>
    <a class="sidebar-nav-item" href="/about/"><i class="fa fa-hand-o-right fa-fw"></i>&nbsp å…³äºÂ·&nbspAbout</a>
    <!-- <span class="sidebar-nav-item"><i class="fa fa-info-circle">&nbsp&nbsp  </i>Currently v1.0.0</span> -->
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2018. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <div class="masthead-title">
            <a href="/" title="Home">fri3nds</a>
            <small>A craftsman typing carefully</small>
          </div>
        </div>
      </div>

      <div class="container content">
        <h2 class="post-name">Blog</h2>
<div class="post">
  <div class="post-heading inside">
    <img src="/public/img/chenglong.jpg">
    <h1 class="post-title">
      <a class="post-title-blog" href="">
        webpack æºç åˆ†æ
      </a>
    </h1>
      <p class="post-info">
        
          fri3nds åŸåˆ›
        
      </p>
      <span class="post-info"><i class="fa fa-calendar"></i>&nbsp2018/06/17  </span>
      <span class="post-info"><i class="fa fa-book"></i>&nbsp<a href="/category/index.html#æŠ€æœ¯åšæ–‡">æŠ€æœ¯åšæ–‡</a></span>
      
        <span class="post-info">&nbsp<a href="/tag/index.html#javascript">javascript</a></span>
      
  </div>
  <div class="post-content">
    <h1 id="webpack-æºç åˆ†æ">webpack æºç åˆ†æ</h1>
<p><img src="/public/img/webpack-logo.svg" alt="webpack-logo" /></p>

<p>webpack æ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„é™æ€æ¨¡å—æ‰“åŒ…å™¨(module bundler)</p>

<h2 id="æ¦‚å¿µ">æ¦‚å¿µ</h2>

<p>webpack æ˜¯ä¸€ä¸ªé«˜åº¦å¯é…ç½®çš„ï¼Œæƒ³è¦é©¾é©­å®ƒä½ å¿…é¡»é¦–å…ˆç†è§£å…¶ 4 ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š</p>
<ul>
  <li>å…¥å£ enry</li>
  <li>è¾“å‡º output</li>
  <li>loader</li>
  <li>æ’ä»¶ plugins</li>
</ul>

<p><img src="/public/img/1527947274105.jpg" alt="1527947274105" /></p>

<p>ä¸Šå›¾æ˜¯ webpack é…ç½®æ–‡ä»¶çš„ä¸€ä¸ªğŸŒ°</p>

<p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ <code class="highlighter-rouge">æ¨¡å¼</code> è¿™ä¸ªæ¦‚å¿µï¼Œä¸»è¦æ˜¯ webpack æ ¹æ®ä¸åŒæ¨¡å¼å¼€å¯ç›¸åº”çš„å†…ç½®çš„ä¼˜åŒ–ã€‚</p>

<p>æ³¨æ„ï¼šæ–°ç‰ˆæ–‡æ¡£åŠ å…¥ Browser Compatibility</p>

<blockquote>
  <p>webpack supports all browsers that areÂ <a href="https://kangax.github.io/compat-table/es5/">ES5-compliant</a>Â (IE8 and below are not supported). webpack needsÂ <code class="highlighter-rouge">Promise</code>Â forÂ <code class="highlighter-rouge">import()</code>Â andÂ <code class="highlighter-rouge">require.ensure()</code>. If you want to support older browsers, you will need toÂ <a href="https://webpack.js.org/guides/shimming/">load a polyfill</a>Â before using these expressions.</p>
</blockquote>

<h2 id="æœºåˆ¶">æœºåˆ¶</h2>

<p>æœ¬æ–‡çš„åˆ†ææ˜¯åŸºäº webpack 3.11.0 äº†ï¼Œæ–°çš„ç‰ˆæœ¬æ”¯æŒäº†ä¸€äº›æ–°çš„ç‰¹æ€§ï¼Œä¸åœ¨è®¨è®ºèŒƒå›´ã€‚</p>

<p><img src="/public/img/webpack-flow.jpg" alt="webpack-flow" /></p>

<p><img src="/public/img/bin-webpack.jpg" alt="bin-webpack" /></p>

<p>ä¸Šè¿°çš„æºç æˆªå›¾å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°æ‰§è¡Œ <code class="highlighter-rouge">webpack</code> å‘½ä»¤æ—¶ä¼šåšä»€ä¹ˆå¤„ç†ï¼Œä¸»è¦æ˜¯è§£æå‘½ä»¤è¡Œå‚æ•°ä»¥åŠæ‰§è¡Œæ‰“åŒ…ï¼Œå…¶ä¸­ <code class="highlighter-rouge">processOptions</code> å°±æ˜¯ <code class="highlighter-rouge">/bin/webpack.js</code> çš„æ ¸å¿ƒå‡½æ•°ã€‚</p>

<p><img src="/public/img/options.jpg" alt="options" /></p>

<p>è§£æå‡ºæ¥çš„ options å‚æ•°</p>

<p><img src="/public/img/processOptions.jpg" alt="processOptions" /></p>

<p><img src="/public/img/lib-webpack.jpg" alt="lib-webpack" /></p>

<p>ä¸Šè¿° webpack å‡½æ•°é‡Œï¼Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ä¸‹ï¼š</p>
<ul>
  <li>
    <p>Compilerï¼ŒCompiler ç±»ç»§æ‰¿ Tapableï¼Œè¿™ä¸ª Tapable æ˜¯ä¸€ä¸ªæ’ä»¶æ¡†æ¶ï¼Œé€šè¿‡ç»§æ‰¿å®ƒçš„ä¸€ç³»åˆ—æ–¹æ³•æ¥å®ç°æ³¨å†Œå’Œè°ƒç”¨æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ webpack çš„æºç ä¸­ï¼Œå­˜åœ¨å¤§é‡çš„ compiler.applyã€compiler.applyPluginsã€compiler.plugin ç­‰Tapableæ–¹æ³•çš„è°ƒç”¨ã€‚Webpack çš„ plugin æ³¨å†Œå’Œè°ƒç”¨æ–¹å¼ï¼Œéƒ½æ˜¯æºè‡ª Tapable ã€‚Webpack é€šè¿‡ plugin çš„ apply æ–¹æ³•å®‰è£…è¯¥ pluginï¼ŒåŒæ—¶ä¼ å…¥ä¸€ä¸ª webpack ç¼–è¯‘å¯¹è±¡ï¼ˆWebpack compiler objectï¼‰ã€‚</p>

    <p><img src="/public/img/compiler.jpg" alt="compiler" /></p>
  </li>
  <li>
    <p>compiler.options = new WebpackOptionsApply().process(options, compiler)
è¿™ä¸ªæ–¹æ³•å°†ä¼šé’ˆå¯¹æˆ‘ä»¬ä¼ è¿›å»çš„ <code class="highlighter-rouge">compiler</code> è¿›è¡Œä¸€äº›æ“ä½œï¼Œé‚£ä¹ˆå¹²äº†ä»€ä¹ˆå‘¢</p>

    <p><img src="/public/img/WebpackOptionsApply.jpg" alt="WebpackOptionsApply" /></p>

    <p>å†™äº†å¾ˆå¤šä»£ç ï¼Œæ€»ç»“ä¸‹æ¥å°±å¹²äº† 3 ä»¶äº‹æƒ…</p>

    <ul class="task-list">
      <li class="task-list-item">
        <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />æŠŠ <code class="highlighter-rouge">options</code> ä¸Šçš„é…ç½®ä¿¡æ¯å¤åˆ¶åˆ° <code class="highlighter-rouge">compiler</code> ä¸Š</p>
      </li>
      <li class="task-list-item">
        <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />æ”¯æŒäº†ä¸€ä¸‹ä¸åŒ target(<del>æœ‰æœ¬äº‹ï¼Œä½ æ”¯æŒ React Native ç¯å¢ƒå•Š</del>)ï¼Œå¹¶æ³¨å†Œäº†ä¸åŒ target çš„å†…ç½®æ’ä»¶</p>
      </li>
      <li class="task-list-item">
        <p><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />æ³¨å†Œäº†å¤§é‡å†…ç½®æ’ä»¶</p>
      </li>
    </ul>
  </li>
</ul>

<h2 id="ç¼–è¯‘ä¸ä¸»æµç¨‹">ç¼–è¯‘ä¸ä¸»æµç¨‹</h2>
<p>webpack çš„å®é™…å…¥å£æ˜¯ Compiler ä¸­çš„ run æ–¹æ³•ï¼Œrun ä¸€æ—¦æ‰§è¡Œåï¼Œå°±å¼€å§‹äº†ç¼–è¯‘å’Œæ„å»ºæµç¨‹ ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªæ¯”è¾ƒå…³é”®çš„ webpack äº‹ä»¶èŠ‚ç‚¹ã€‚å…·ä½“çš„äº‹ä»¶èŠ‚ç‚¹ï¼Œwebpack æä¾›äº†è¯¦ç»†çš„ <a href="https://webpack.js.org/api/compiler-hooks/">hooks</a></p>
<ul>
  <li>
    <p><code class="highlighter-rouge">entry-option</code> åˆå§‹åŒ– option</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">run</code> å¼€å§‹æ‰§è¡Œ</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">compile</code> å¼€å§‹ç¼–è¯‘</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">make</code> ä»å…¥å£ç‚¹åˆ†ææ¨¡å—åŠå…¶ä¾èµ–çš„æ¨¡å—ï¼Œåˆ›å»ºè¿™äº›æ¨¡å—å¯¹è±¡</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">before-resolve</code> è§¦å‘ <code class="highlighter-rouge">factory</code> äº‹ä»¶</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">factory</code> è§¦å‘ <code class="highlighter-rouge">resolver</code> äº‹ä»¶</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">build-resolve</code> <code class="highlighter-rouge">after-resolve</code> å¯¹å…¶ä¸­ä¸€ä¸ªæ¨¡å—ä½ç½®è¿›è¡Œè§£æ</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">build-module</code> å¼€å§‹æ„å»º(build)è¿™ä¸ª moduleï¼Œè¿™é‡Œå°†ä½¿ç”¨æ–‡ä»¶å¯¹åº”çš„ loader åŠ è½½</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">after-compile</code> å®Œæˆæ„å»º</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">seal</code> å°è£…æ„å»ºç»“æœ</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">emit</code> æŠŠå„ä¸ª chunk è¾“å‡ºåˆ°ç»“æœæ–‡ä»¶</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">after-emit</code> å®Œæˆè¾“å‡º</p>

    <p><img src="/public/img/webpack-runtime.png" alt="webpack-runtime" /></p>
  </li>
</ul>

<h3 id="1-run">1. run</h3>
<p><img src="/public/img/before-run-and-run.jpg" alt="before-run-and-run" />
æ‰§è¡Œäº† before-run å’Œ run ä¹‹åï¼Œå¼€å§‹è°ƒç”¨ compiler.compile æ–¹æ³•</p>

<h3 id="2-compile">2. compile</h3>
<p><img src="/public/img/compile.jpg" alt="compile" /></p>

<p>è°ƒç”¨ compiler.compile æ–¹æ³•ï¼Œé¦–å…ˆè§¦å‘ <code class="highlighter-rouge">before-compile</code> ç„¶åè§¦å‘ <code class="highlighter-rouge">compile</code> äº‹ä»¶ï¼Œç„¶åæ„å»º compilation å®ä¾‹</p>

<p><img src="/public/img/compilation.png" alt="compilation" /></p>

<p>è¿™ä¸ªå¯¹è±¡æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œä¸€æ˜¯è´Ÿè´£ç»„ç»‡æ•´ä¸ªæ‰“åŒ…è¿‡ç¨‹ï¼ŒåŒ…å«äº†æ¯ä¸ªæ„å»ºç¯èŠ‚åŠè¾“å‡ºç¯èŠ‚æ‰€å¯¹åº”çš„æ–¹æ³•ï¼Œå¯ä»¥ä»å›¾ä¸­çœ‹åˆ°æ¯”è¾ƒå…³é”®çš„æ­¥éª¤ï¼Œå¦‚ <code class="highlighter-rouge">addEntry()</code>, <code class="highlighter-rouge">_addModuleChain()</code>, <code class="highlighter-rouge">buildModule()</code>, <code class="highlighter-rouge">seal()</code>, <code class="highlighter-rouge">createChunkAssets()</code> (åœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¼šè§¦å‘ webpack äº‹ä»¶å»è°ƒç”¨å„æ’ä»¶)ã€‚äºŒæ˜¯è¯¥å¯¹è±¡å†…éƒ¨å­˜æ”¾ç€æ‰€æœ‰ module ï¼Œchunkï¼Œç”Ÿæˆçš„ asset ä»¥åŠç”¨æ¥ç”Ÿæˆæœ€åæ‰“åŒ…æ–‡ä»¶çš„ template çš„ä¿¡æ¯ã€‚</p>

<p><img src="/public/img/newCompilation.jpg" alt="newCompilation" />
ä¸Šå›¾å¯ä»¥çœ‹åˆ°åˆå§‹åŒ– compilation çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜è§¦å‘äº† <code class="highlighter-rouge">this-compilation</code> å’Œ <code class="highlighter-rouge">compilation</code> ä¸¤ä¸ªäº‹ä»¶</p>

<p>this-compilation äº‹ä»¶è§¦å‘ <code class="highlighter-rouge">CommonsChunkPlugin</code> æ’ä»¶ï¼Œåœ¨è¿™ä¸ªæ—¶å€™æ‰§è¡Œäº†ï¼Œå¾€ <code class="highlighter-rouge">compilation</code> ä¸Šæ³¨å†Œäº† <code class="highlighter-rouge">optimize-chunks</code> å’Œ <code class="highlighter-rouge">optimize-extracted-chunks</code> ä¸¤ä¸ªäº‹ä»¶
è¿˜è§¦å‘äº† <code class="highlighter-rouge">extract-text-webpack-plugin</code> æ’ä»¶ï¼Œå…¶åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œå¾€ <code class="highlighter-rouge">compilation</code> ä¸Šæ³¨å†Œäº† <code class="highlighter-rouge">normal-module-loader</code> äº‹ä»¶ã€‚</p>

<p>compilation äº‹ä»¶å°±æ›´å‰å®³äº†ï¼Œè§¦å‘äº†ä¸€å †æ’ä»¶ã€‚</p>

<h3 id="3-make">3. make</h3>

<p>åœ¨åˆå§‹åŒ– compilation åï¼Œå°±å¼€å§‹äº† <code class="highlighter-rouge">make</code> çš„é˜¶æ®µã€‚</p>

<p><img src="/public/img/MultiEntryPlugin.jpg" alt="MultiEntryPlugin" /></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MultiEntryDependency.js</span>
<span class="kd">const</span> <span class="nx">Dependency</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"../Dependency"</span><span class="p">);</span>

<span class="kd">class</span> <span class="nx">MultiEntryDependency</span> <span class="kd">extends</span> <span class="nx">Dependency</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(</span><span class="nx">dependencies</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">super</span><span class="p">();</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">dependencies</span> <span class="o">=</span> <span class="nx">dependencies</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kd">get</span> <span class="nx">type</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">return</span> <span class="s2">"multi entry"</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">MultiEntryDependency</span><span class="p">;</span>


<span class="c1">// SingleEntryDependency.js</span>
<span class="kd">const</span> <span class="nx">ModuleDependency</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"./ModuleDependency"</span><span class="p">);</span>

<span class="kd">class</span> <span class="nx">SingleEntryDependency</span> <span class="kd">extends</span> <span class="nx">ModuleDependency</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">super</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kd">get</span> <span class="nx">type</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">return</span> <span class="s2">"single entry"</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">SingleEntryDependency</span><span class="p">;</span>

<span class="c1">// ModuleDependency.js</span>
<span class="kd">const</span> <span class="nx">Dependency</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"../Dependency"</span><span class="p">);</span>

<span class="kd">class</span> <span class="nx">ModuleDependency</span> <span class="kd">extends</span> <span class="nx">Dependency</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">super</span><span class="p">();</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">request</span> <span class="o">=</span> <span class="nx">request</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">userRequest</span> <span class="o">=</span> <span class="nx">request</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nx">isEqualResource</span><span class="p">(</span><span class="nx">other</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">other</span> <span class="k">instanceof</span> <span class="nx">ModuleDependency</span><span class="p">))</span>
			<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">request</span> <span class="o">===</span> <span class="nx">other</span><span class="p">.</span><span class="nx">request</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">ModuleDependency</span><span class="p">;</span>
</code></pre></div></div>
<p>å¥½åƒä»€ä¹ˆğŸ‚é€¼çš„äº‹æƒ…éƒ½æ²¡æœ‰å¹²å•Šï¼
åˆå§‹åŒ–å¥½ dependencies(dependencies æ˜¯ä¸€ä¸ª SingleEntryDependency å®ä¾‹çš„array) åï¼Œå°±å¼€å§‹äº† compilationl.addEntry æ–¹æ³•ã€‚ åœ¨ addEntry ä¸­è°ƒç”¨ç§æœ‰æ–¹æ³• _addModuleChainã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦åšäº†ä¸¤ä»¶äº‹æƒ…ï¼Œä¸€æ˜¯æ ¹æ®æ¨¡å—çš„ç±»å‹è·å–å¯¹åº”çš„æ¨¡å—å·¥å‚å¹¶åˆ›å»ºæ¨¡å—ï¼ŒäºŒæ˜¯æ„å»ºæ¨¡å—ã€‚</p>

<p><img src="/public/img/addModuleChain.jpg" alt="addModuleChain" /></p>

<p>åœ¨ä¹‹å‰è§¦å‘ compilation åï¼Œå¾ˆå¤šæ’ä»¶å¾€ compilation.dependencyFactories è¿™ä¸ª Set å¡äº†å¾ˆå¤šæ¨¡å—å·¥å‚ã€‚</p>

<p>å–å‡ºå¯¹åº”çš„æ¨¡å—å·¥å‚ï¼Œè°ƒç”¨å…¶é™æ€æ–¹æ³• create, åˆå§‹åŒ– Module å®ä¾‹ã€‚</p>

<p><img src="/public/img/MultiModule.jpg" alt="MultiModule" /></p>

<p>ç„¶åè°ƒç”¨äº† compilation.addModule æ–¹æ³•ï¼Œå°† module å­˜å‚¨åœ¨ compilation.modules è¿™ä¸ªæ•°ç»„é‡Œï¼Œå¹¶è¿”å› true è¡¨ç¤ºæ·»åŠ æˆåŠŸã€‚</p>

<p>ä¹‹å‰ MultiEntryPlugin.createDependency æ ¹æ® entry åˆ›å»ºäº† MultiEntryDependency å®ä¾‹ã€‚</p>

<p><img src="/public/img/addEntry.jpg" alt="addEntry" /></p>

<p>å°† module ç»‘å®šåˆ° entry ä¸Šï¼Œåˆå°† module å­˜å‚¨åˆ°äº† compilation.entries æ•°ç»„é‡Œã€‚</p>

<p>buildModule å‡½æ•°å†…éƒ¨ï¼Œè§¦å‘<code class="highlighter-rouge">build-module</code> äº‹ä»¶ï¼Œè°ƒç”¨ module.build æ–¹æ³•ã€‚å°±æ˜¯ç®€å•åœ°å°† module.built ç½®ä¸º trueï¼Œæœ€åè°ƒç”¨ compilation é‡Œé¢çš„ moduleReady æ–¹æ³•ï¼Œè¿›è€Œè°ƒç”¨ compilation.processModuleDependencies æ–¹æ³•ã€‚</p>

<p>ä¸­é—´ä» module.dependences é€’å½’æ‹¿åˆ° SingleEntryDependency å¯¹åº”çš„ factoryï¼Œå…¶ä¸­è§¦å‘ <code class="highlighter-rouge">build-resolve</code> äº‹ä»¶ï¼Œfactory æœ€åè°ƒç”¨äº† enhanced-resolve æä¾›çš„ <code class="highlighter-rouge">Resolver</code> å®ä¾‹çš„ doResolve æ–¹æ³•ã€‚</p>

<p><code class="highlighter-rouge">create-module</code> æœ€åè°ƒç”¨äº† NormalModule, NormalModule createLoaderContext åˆ›å»º loader ä¸Šä¸‹æ–‡ï¼Œæœ€åä¼šå»è°ƒç”¨ LoaderRunner çš„ runLoaders, runLoaders çš„å›è°ƒå®Œæˆäº† sourceMap çš„ä¸€äº›åŠŸèƒ½ï¼Œæœ€åæ‰§è¡Œäº† doBuild(NormalModule çš„å®ä¾‹æ–¹æ³•) ä¼ å…¥çš„å›è°ƒå³ this.parser.parse(this ä¹Ÿæ˜¯ NormalModule çš„å®ä¾‹)</p>

<p><img src="/public/img/NormalModule-build.jpg" alt="NormalModule-build" /></p>

<p><img src="/public/img/Parser.jpg" alt="Parser" /></p>

<p>parser çš„ parse æ–¹æ³•å°±æ˜¯è°ƒç”¨ <a href="https://github.com/ternjs/acorn">acorn</a> è§£æç» loader å¤„ç†åçš„æºæ–‡ä»¶ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ ASTï¼Œç„¶åè§¦å‘äº† program äº‹ä»¶</p>

<p><img src="/public/img/Parser-state.jpg" alt="Parser-state" /></p>

<p>æœ€åè¿”å›çš„ state çš„æ•°æ®å¦‚å›¾ã€‚</p>

<p>é€’å½’è§£æå®Œentryåï¼Œæœ€åä¼šè°ƒç”¨ compilation.seal æ–¹æ³•ã€‚</p>

<p><img src="/public/img/Compilation-seal.jpg" alt="Compilation-seal" /></p>

<p>ä¸­é—´çš„å¾ˆå¤šäº‹ä»¶è§¦å‘åï¼Œè°ƒç”¨äº† compilation.createModuleAssets æ–¹æ³•è¿›è¡Œæ‰“åŒ…åä»£ç çš„ç”Ÿæˆã€‚
(æœªå®Œå¾…ç»­â€¦)</p>

<h2 id="webpack-ä¸­çš„ä¸€äº›æ¦‚å¿µ">webpack ä¸­çš„ä¸€äº›æ¦‚å¿µ</h2>

<p>webpack æ»¡è¶³å…¶é«˜åº¦è‡ªå®šä¹‰çš„å¯èƒ½æ€§ï¼Œä¹Ÿå¸¦æ¥äº†é…ç½®çš„å¤æ‚æ€§ï¼Œå·²ç»å¯ä»¥<a href="http://webpack.wuhaolin.cn/">è‘—ä¹¦ç«‹ä¼ </a></p>
<ol>
  <li><code class="highlighter-rouge">module</code> ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥çœ‹æˆä¸€ä¸ª module</li>
  <li><code class="highlighter-rouge">chunk</code> code splitting åçš„äº§ç‰©ï¼Œä¹Ÿå°±æ˜¯æŒ‰éœ€åŠ è½½çš„åˆ†å—ï¼Œè£…è½½äº†ä¸åŒçš„ module</li>
  <li><code class="highlighter-rouge">filename</code> output é…ç½®ä¸‹çš„ä¸€ä¸ªé€‰é¡¹ï¼Œæ¯ä¸€ä¸ª bundle çš„å‘½åæ¨¡æ¿</li>
  <li><code class="highlighter-rouge">chunkFileName</code> å¯ä»¥å‚è€ƒ <a href="https://segmentfault.com/q/1010000003850413?_ea=769657">æˆ‘çš„å›ç­”</a></li>
</ol>

<p>å¯¹äº module å’Œ chunk çš„å…³ç³»å¯ä»¥å‚ç…§ webpack å®˜æ–¹çš„è¿™å¼ å›¾</p>

<p><img src="/public/img/module-vs-chunk.jpg" alt="module-vs-chunk" /></p>

<p>webpack çš„ä½œè€…ä¹Ÿå›ç­”äº† <a href="https://github.com/webpack/webpack.js.org/issues/970">Concepts - Bundle vs Chunk</a>  è¿™ä¸ªé—®é¢˜</p>

<blockquote>
  <p>A chunk is a bundle.
Yes a chunk is a bundle. Chunk the class is the encapsulation for parts of your dependency graph.
There are three classifications of Chunks:</p>
  <ul>
    <li><code class="highlighter-rouge">Entry chunk</code>: An entry chunk is an emitted file which contains the webpack runtime code. To be classified as an entry chunk, the emitted JS bundle/file must contain that bootstrap code seen above. Sometimes there will be no modules and they can be isolated into separate files. The entry chunk must always be executed first.</li>
    <li><code class="highlighter-rouge">Initial chunk</code>: An initial chunk is loaded synchronously however doesnâ€™t contain the runtime code.</li>
    <li><code class="highlighter-rouge">Normal chunk</code>: The only thing that separates an initial chunk from a normal chunk is how the file is loaded. Normal chunks are always lazy loaded and asynchronous. For example when I use require.ensure, or System.import or import(), webpack will separate any of the modules into a separate normal chunk.</li>
  </ul>
</blockquote>

<blockquote>
  <p>Is it always one chunk for output file?
The only case where it is not, is when there are for example sourcemaps that are emitted alongside. These multiple assets that are written to disk are known as chunk assets.</p>
</blockquote>

<h2 id="æ³¨å†Œæ’ä»¶">æ³¨å†Œæ’ä»¶</h2>

<p><img src="/public/img/NodeEnvironmentPlugin.jpg" alt="NodeEnvironmentPlugin" /></p>

<p><code class="highlighter-rouge">NodeEnvironmentPlugin</code> æ’ä»¶ç±»å¿…é¡»æœ‰ <code class="highlighter-rouge">apply</code> å®ä¾‹æ–¹æ³•ï¼Œå¯ä»¥æ‹¿åˆ° webpack æ•´ä¸ª <code class="highlighter-rouge">compiler</code> å®ä¾‹ï¼Œ</p>

<p><img src="/public/img/other-plugins.jpeg" alt="other-plugins" /></p>

<p>ä¸Šå›¾ä¸­çš„éƒ½æ˜¯è§£æ webpack.config æ–‡ä»¶å¾—åˆ°çš„ options çš„ plugins</p>

<p><img src="/public/img/Tapable.jpg" alt="Tapable" /></p>

<p>æ’ä»¶é€šè¿‡ <code class="highlighter-rouge">apply</code> æ–¹æ³•ï¼Œæ‹¿åˆ° <code class="highlighter-rouge">compiler</code> å®ä¾‹ï¼Œåœ¨ <code class="highlighter-rouge">apply</code> æ–¹æ³•å†…ï¼Œé€šè¿‡ <code class="highlighter-rouge">compiler.plugin</code> æ–¹æ³•ï¼Œæ¥æ³¨å†Œæ’ä»¶ã€‚
å¦‚ä½•ç¼–å†™ä¸€ä¸ª webpack çš„æ’ä»¶å¯ä»¥å‚è€ƒ <a href="https://webpack.js.org/contribute/writing-a-plugin/">how to witre a plugin</a></p>

<h2 id="webpack-ä¸­çš„ä¸€äº›-tapable-å®ä¾‹">webpack ä¸­çš„ä¸€äº› Tapable å®ä¾‹</h2>
<ul>
  <li>Compiler</li>
  <li>Compilation</li>
  <li>Resolver</li>
  <li>NormalModuleFactory</li>
  <li>ContextModuleFactory</li>
  <li>Template</li>
  <li>Template Subclass - MainTemplate/ChunkTemplate/ModuleTemplate/DependencyTemplate</li>
  <li>Parser</li>
</ul>

<p>(å…·ä½“çš„è¯¦ç»†è§£é‡Šå¯ä»¥æŸ¥çœ‹<a href="https://medium.com/webpack/the-contributors-guide-to-webpack-part-2-9fd5e658e08c">æ–‡ç« </a>)</p>

<h2 id="webpack-çš„ä¸€äº›ä¼˜åŒ–">webpack çš„ä¸€äº›ä¼˜åŒ–</h2>
<ul>
  <li>scope hoisting(ä½œç”¨åŸŸæå‡)
new webpack.optimize.ModuleConcatenationPlugin()
https://github.com/webpack/webpack/tree/master/examples/scope-hoisting</li>
</ul>

<p>ç›´è§‚æ„Ÿå—å°±æ˜¯â€”â€”å‡½æ•°å£°æ˜å°‘äº†å¾ˆå¤šï¼Œå› æ­¤è€Œå¸¦æ¥çš„å¥½å¤„æœ‰ï¼š</p>

<ol>
  <li>æ–‡ä»¶ä½“ç§¯æ¯”ä¹‹å‰æ›´å°ã€‚</li>
  <li>è¿è¡Œä»£ç æ—¶åˆ›å»ºçš„å‡½æ•°ä½œç”¨åŸŸä¹Ÿæ¯”ä¹‹å‰å°‘äº†ï¼Œå¼€é”€ä¹Ÿéšä¹‹å˜å°ã€‚</li>
</ol>

<p>é¡¹ç›®ä¸­çš„æ¨¡å—è¶Šå¤šï¼Œä¸Šè¿°çš„ä¸¤ç‚¹æå‡å°±ä¼šè¶Šæ˜æ˜¾ã€‚</p>

<ul>
  <li>
    <p>pure module
https://github.com/webpack/webpack/tree/feature/pure-module/examples/pure-module</p>
  </li>
  <li>
    <p>tree shaking
https://webpack.js.org/guides/tree-shaking/</p>
  </li>
</ul>

<p>tree shaking çš„å°´å°¬æ˜¯</p>
<ol>
  <li>cmd ä¸è¡Œ</li>
  <li>es6 æœ‰äº† import åŠ¨æ€å¼•å…¥ä¾èµ–</li>
  <li>æœ‰äº›åº“ä¼šå°†æœ€ç»ˆçš„è¾“å‡ºå…ƒç´ ç”¨Object.freezeæ–¹æ³•åŒ…è£¹èµ·æ¥, å¼•å…¥äº†å‰¯ä½œç”¨</li>
</ol>

<ul>
  <li>split Chunk
    <ol>
      <li>DllPluginå’ŒCommonsChunkPluginï¼ˆsplitChunksï¼‰å¯ä»¥å…±å­˜å—ï¼Ÿ</li>
      <li>è®¸å¤šäººåœ¨ä½¿ç”¨CommonsChunkPluginçš„æ—¶å€™å¹¶æ²¡æœ‰æ³¨æ„åˆ°Webpackä¼šå°†runtimeä¸€èµ·æ‰“åŒ…è¿›vendorsæ–‡ä»¶ï¼Œæ‰€ä»¥æ¯æ¬¡å¯åŠ¨çš„æ—¶å€™ï¼Œå°½ç®¡ä½ å¹¶æ²¡æœ‰ä¿®æ”¹ä»»ä½•ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œä½†æ˜¯vendorsæ–‡ä»¶çš„hashå€¼å´å˜äº†ï¼Œå¯¼è‡´æµè§ˆå™¨ç¼“å­˜å®é™…ä¸Šå¹¶æ²¡æœ‰è¢«åˆ©ç”¨èµ·æ¥ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦é…ç½®CommonsChunkPluginå°†runtimeå•ç‹¬æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ã€‚</li>
    </ol>
  </li>
</ul>

<p>https://zhuanlan.zhihu.com/p/35407642</p>

<p>webpack 4 çš„ä¸€äº›æ–°ä¸œè¥¿
http://zcfy.baomitu.com/article/webpack-4-changes-part-1-week-24-25-webpack-medium-4303.html</p>

<p>webpack 4 é‡‡å‘å°ç™½é¼ 
https://zhuanlan.zhihu.com/p/37896189</p>

<p>æˆ‘çš„æ¨è
thread-loader
webpack-stylish</p>

<h2 id="tapable">Tapable</h2>
<p>å¿…é¡»åæ§½ä¸€ä¸‹ï¼ŒTapable çš„æ–¹æ³•å‘½åç®€ç›´å°±æ˜¯åƒåœ¾ï¼Œä¸‹é¢è®²ä¸€ä¸‹</p>

<p><code class="highlighter-rouge">apply</code> <code class="highlighter-rouge">applyPlugins</code> <code class="highlighter-rouge">plugin</code> <code class="highlighter-rouge">applyPluginsBailResult</code> <code class="highlighter-rouge">applyPluginsAsync</code> çš„åŒºåˆ«</p>

<ol>
  <li>
    <p>apply</p>

    <p>æ³¨å†Œæ’ä»¶</p>
  </li>
  <li>
    <p>plugin</p>

    <p>ç›‘å¬äº‹ä»¶ï¼Œå¹¶æ·»åŠ äº‹ä»¶å›è°ƒ</p>
  </li>
  <li>
    <p>applyPlugins</p>

    <p>è§¦å‘äº‹ä»¶ï¼Œé€šçŸ¥æ’ä»¶</p>
  </li>
  <li>
    <p>applyPluginsBailResult</p>

    <p>è§¦å‘äº‹ä»¶ï¼Œé€šçŸ¥æ’ä»¶ï¼Œä¸”æ’ä»¶çš„å›è°ƒå¿…é¡»æœ‰è¿”å›å€¼</p>
  </li>
  <li>
    <p>applyPluginsAsync applyPluginsAsyncSeries</p>

    <p>æ³¨å†Œå›è°ƒï¼Œè§¦å‘äº‹ä»¶ï¼Œé€šçŸ¥æ’ä»¶</p>
  </li>
  <li>
    <p>applyPluginsBailResult
è§¦å‘äº‹ä»¶ï¼Œå¹¶æ‹¿åˆ°ç›‘å¬äº‹ä»¶çš„å›è°ƒçš„æ‰§è¡Œç»“æœ</p>
  </li>
</ol>

<h2 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h2>

<p>webpack æ ¸å¿ƒå¼€å‘è€…å†™çš„é«˜çº§è€å¸æœºæŒ‡å—: <a href="https://medium.com/webpack/contributors-guide/home">https://medium.com/webpack/contributors-guide/home</a></p>

<p>å‘½ä»¤è¡Œè¾“å…¥webpackçš„æ—¶å€™éƒ½å‘ç”Ÿäº†ä»€ä¹ˆ: <a href="https://github.com/DDFE/DDFE-blog/issues/12">https://github.com/DDFE/DDFE-blog/issues/12</a></p>

<p>ç»†è¯´ webpack ä¹‹æµç¨‹ç¯‡: <a href="http://taobaofed.org/blog/2016/09/09/webpack-flow/">http://taobaofed.org/blog/2016/09/09/webpack-flow/</a></p>

<p>webpack æºç è§£æ: <a href="https://lihuanghe.github.io/2016/05/30/webpack-source-analyse.html">https://lihuanghe.github.io/2016/05/30/webpack-source-analyse.html</a></p>

<p>Tapable å’Œ äº‹ä»¶æµ: <a href="https://segmentfault.com/a/1190000008060440">https://segmentfault.com/a/1190000008060440</a></p>

<p>webpack ä¸»è¦å¯¹è±¡: <a href="https://segmentfault.com/a/1190000008060484">https://segmentfault.com/a/1190000008060484</a></p>

<p>å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„webpack: <a href="https://github.com/youngwind/blog/issues/99">https://github.com/youngwind/blog/issues/99</a></p>

<p>webpack è¯¦ç»†çš„æ„å»ºè¿‡ç¨‹: <a href="https://github.com/liangklfangl/webpack-compiler-and-compilation">https://github.com/liangklfangl/webpack-compiler-and-compilation</a></p>

  </div>
</div>

<!-- <div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/%E6%8A%80%E6%9C%AF%E5%8D%9A%E6%96%87/2018/07/22/lazy/">
            lazy && fp
            <small>22 Jul 2018</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/%E6%8A%80%E6%9C%AF%E5%8D%9A%E6%96%87/2018/07/01/promise-is-a-monad/">
            promise is a monad?
            <small>01 Jul 2018</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/%E6%8A%80%E6%9C%AF%E5%8D%9A%E6%96%87/2017/01/14/2016-Mac-%E5%B9%B3%E5%8F%B0%E5%B8%B8%E7%94%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B7%A5%E5%85%B7-%E8%BD%AF%E4%BB%B6/">
            Mac å¹³å°å¸¸ç”¨çš„ä¸€äº›å·¥å…·ã€è½¯ä»¶
            <small>14 Jan 2017</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div> -->


<div class="sub_pagination">

  
    <a class="sub_pagination-item newer" href="/%E6%8A%80%E6%9C%AF%E5%8D%9A%E6%96%87/2018/07/01/promise-is-a-monad/">ä¸Šä¸€ç¯‡&nbsp<i class="fa fa-chain"></i></a>
  
  
    <a class="sub_pagination-item newer" href="/%E6%8A%80%E6%9C%AF%E5%8D%9A%E6%96%87/2017/01/14/2016-Mac-%E5%B9%B3%E5%8F%B0%E5%B8%B8%E7%94%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B7%A5%E5%85%B7-%E8%BD%AF%E4%BB%B6/">Mac å¹³å°å¸¸ç”¨çš„ä¸€äº›å·¥å…·ã€è½¯ä»¶&nbsp<i class="fa fa-share"></i></a>
  
</div>


<!-- <div class="comments"> -->
<h2>Comments</h2>



<!-- Comment BEGIN -->
<div id="gitmentContainer"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
  var gitment = new Gitment({
    owner: 'xiaoDC',
    id: '2018-06-17 00:00:00 +0800',
    repo: 'xiaoDC.github.io',
    oauth: {
      /* client_id: '180d6605718d1095fd97', */
      client_id: '2d24c41652751846a57d',
      /* client_secret: '160e63d30cac752d518dc4eefd5f21c0443230b5', */
      client_secret: 'ae79911add5cfa32198599cf852bdb427e445483',
    },
  });
  gitment.render('gitmentContainer');
</script>

<!-- Comment END -->

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    <div class="footer">
  <ul>
    <span>å‹æƒ…é“¾æ¥ âŸ¹&nbsp;&nbsp;</span>
    <li><a href="http://sound2gd.wang">sound2gd</a></li>
    <li><a href="https://wangqiao.me">å¤œè‰²æ®‹é˜³ã®æ‚è´§é“ºå­</a></li>
  </ul>
  </p></p>
  <p>  Copyright Â© 2018 - <a href="/">fri3nds</a> - Powered by
    <a href="http://jekyllrb.com/">Jekyll</a>.
    <a href="http://github.com/">Github</a>
  </p>
  <ul>
    <!-- <li><a href="/"><i class="fa fa-twitter fa-2x"></i></a></li> -->
    <li><a href="https://github.com/xiaoDC"><i class="fa fa-github fa-2x"></i></a></li>
    <!-- <li><a href="https://www.linkedin.com/nhome/?trk="><i class="fa fa-linkedin fa-2x"></i></a></li> -->
  </ul>
</div>


    <!-- "The ending isnâ€™t any more important than the moments leading to it." -Dr. Eva Rosalene, To The Moon -->
  </body>
</html>

